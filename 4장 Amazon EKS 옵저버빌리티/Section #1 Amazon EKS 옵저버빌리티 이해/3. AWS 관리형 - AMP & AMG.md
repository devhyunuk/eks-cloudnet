# 3. AWS 관리형 - AMP & AMG
![image](https://github.com/devhyunuk/eks-cloudnet/assets/49749510/ba01774d-e7f0-4b8a-b072-0d0d065e755f)

## 3.1 프로메테우스 아키텍처
![image](https://github.com/devhyunuk/eks-cloudnet/assets/49749510/a3120510-3438-4b64-a82c-c3bc0466f0b9)
1) 프로메테우스 서버 중심으로 서비스를 찾고 대상에 대한 매트릭을 풀 방식으로 수집
2) 얼럿 매니저로 얼럿을 보내거나 시각화 도구인 그라파나로 프로메테우스 쿼리를 통해 대시보드에 표출
3) 프로메테우스 아키텍처는 확장성의 문제나 고가용성 문제
   - 프로메테우스는 클러스터링이 되지 않아 단일 노드에서 모든 매트릭을 처리하는 구조 (대규모 환경에서 성능 저하가 발생 가능)
   -  단일 노드의 구성에 따라 해당 노드가 장애가 발생하면 대처할 방안이 없다는 문제. (장애 발생 시간 동안 매트릭을 수집할 수 없음)

## 3.2 프로메테우스 & 타노스 아키텍처
![image](https://github.com/devhyunuk/eks-cloudnet/assets/49749510/5178fe1d-e9fe-4852-ab68-2c255fd1e4bd)
1) 타노스 사이드카를 구성 -> 프로메테우스 서버와 연결돼서 매트릭을 쿼리하고 스토리지 영역에 저장.
2) 노드마다 타노스 사이드카가 연결돼서 확장성 문제를 해소
3) 타노스 쿼리는 타노스 사이드카로 쿼리를 수행하거나 타노스 스토어에서 데이터를 가져오는 역할
   - 최근 데이터는 타노스 사이드카에 쿼리
   - 오래된 데이터는 타노스 스토어에서 요청
  
4) 시각화 도구인 그라파나는 프로메테우스 서버가 아닌 타노스 쿼리에게 요청해서 대시보드를 구성.
5) 타노스 스토어는 타노스 쿼리에게 요청을 받으면 스토리지 영역에서 데이터를 가져다 전달.
6) 타노스 컴팩터는 다운샘플링 역할을 하는 컴포넌트
   - 다운샘플링은 매트릭 수집 주기를 늘려서 전체 데이터 저장 용량을 낮추는 기능.
   - 1분마다 수집하는 매트릭을 10분마다 수집하도록 다운샘플링 하면 데이터 수량 축소.
  
7) 타노스 구성을 통해 프로메테우스의 문제점을 해소할 수 있지만 리소스 사용량이 높을 경우 동적인 스케일 아웃이 되지 않는 점과 다운 샘플링 조정 및 리소스 자원을 지속적으로 관리해야 하는 한계점

## 3.3 AMP & AMG 아키텍처
![image](https://github.com/devhyunuk/eks-cloudnet/assets/49749510/0595fe27-f61a-4edf-8947-c942bd8316cb)
1) AMP와 AMG는 AWS 관리형으로 동작하는 서버리스 프로메테우스와 그라파나
   - 관리 편의성 높다.
3) 프로메테우스 서버가 매트릭을 수집하는 환경에서 별도의 VPC에 AMP와 AMG를 구성.
4) Workspace라는 단위로 AMP와 AMG를 지정하면 서버리스 형태로 구성
   - 프로메테우스 서버는 Remote Write로 AMP를 지정해서 스크랩한 정보를 전달.
   - AMP는 다수의 가용 영역에 구성할 수 있어 보과용성 확보가 가능
   - AMP에 저장된 데이터는 아마존 S3에 보관되어 150일 동안 안정적으로 유지.
   - AMP의 비용은 수집한 매트릭 수량의 비례에서 책정
6) AMG는 프로메테우스 서버가 아닌 AMP로 쿼리해서 결과를 받아 대시보드에 출력
   - AMG도 AWS 자체에서 관리해주니 AMG 설정만 하고 사용 가능.
   - AMG는 AWS IAM 아이덴티티 센터를 활용해 손쉬운 인증 및 인과를 지원 편리.








   

























